# Deployment Guide for LearnPlay on Render

This guide will walk you through deploying your LearnPlay application to Render.

## Prerequisites

1. A GitHub account
2. Your code pushed to a GitHub repository
3. A Render account (sign up at [render.com](https://render.com) - free tier available)
4. MongoDB Atlas account (or use Render's MongoDB - see below)

## Step 1: Prepare Your Repository

1. Make sure all your code is committed and pushed to GitHub
2. The `render.yaml` file is already in your repository root

## Step 2: Set Up MongoDB

You have two options:

### Option A: Use MongoDB Atlas (Recommended)
1. Go to [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. Create a free cluster (M0 Sandbox)
3. Create a database user
4. Whitelist Render's IP addresses (or use `0.0.0.0/0` for development)
5. Get your connection string (MONGO_URI)

### Option B: Use Render's MongoDB
1. In Render dashboard, create a new MongoDB database
2. Render will provide the connection string automatically

## Step 3: Deploy Backend Service

1. **Go to Render Dashboard**
   - Visit [dashboard.render.com](https://dashboard.render.com)
   - Click "New +" → "Blueprint"

2. **Connect Your Repository**
   - Select your GitHub repository
   - Render will detect the `render.yaml` file automatically

3. **Configure Backend Service**
   - Render will create the backend service from `render.yaml`
   - Go to the backend service settings

4. **Set Environment Variables**
   Navigate to the backend service → Environment tab and set:
   
   ```
   MONGO_URI=mongodb+srv://username:password@cluster.mongodb.net/learnplay?retryWrites=true&w=majority
   ```
   (Replace with your actual MongoDB connection string)
   
   ```
   EMAIL_USER=your-email@gmail.com
   EMAIL_PASS=your-app-password
   ```
   (For Gmail, use an App Password, not your regular password)
   
   - `JWT_SECRET` will be auto-generated by Render
   - `CLIENT_ORIGIN` will be auto-set from the frontend service URL
   - Other email settings are already configured in `render.yaml`

5. **Deploy**
   - Click "Apply" or "Save Changes"
   - Render will start building and deploying your backend
   - Wait for deployment to complete (usually 2-5 minutes)

## Step 4: Deploy Frontend Service

1. **Frontend Service is Auto-Created**
   - Render creates it automatically from `render.yaml`
   - Go to the frontend service settings

2. **Verify Environment Variables**
   - `REACT_APP_API_URL` is automatically set to your backend URL
   - No manual configuration needed!

3. **Deploy**
   - The frontend will build automatically
   - Wait for deployment to complete

## Step 5: Update CORS Settings (If Needed)

If you encounter CORS errors:

1. Go to your backend service in Render
2. Check the `CLIENT_ORIGIN` environment variable
3. Make sure it matches your frontend URL (e.g., `https://learnplay-frontend.onrender.com`)
4. Redeploy if you changed it

## Step 6: Test Your Deployment

1. **Test Backend**
   - Visit: `https://your-backend-url.onrender.com/api/health`
   - Should return: `{"status":"ok"}`

2. **Test Frontend**
   - Visit your frontend URL
   - Try logging in or registering

## Environment Variables Reference

### Backend Service Required Variables:

| Variable | Description | Example |
|----------|-------------|---------|
| `MONGO_URI` | MongoDB connection string | `mongodb+srv://user:pass@cluster.mongodb.net/learnplay` |
| `JWT_SECRET` | Secret for JWT tokens | Auto-generated by Render |
| `CLIENT_ORIGIN` | Frontend URL | Auto-set from frontend service |
| `EMAIL_USER` | Email address for sending emails | `your-email@gmail.com` |
| `EMAIL_PASS` | Email app password | Your Gmail app password |
| `EMAIL_HOST` | SMTP server | `smtp.gmail.com` |
| `EMAIL_PORT` | SMTP port | `587` |
| `EMAIL_FROM_NAME` | Sender name | `LearnPlay` |
| `NODE_ENV` | Environment | `production` |
| `PORT` | Server port | Auto-set by Render |

### Frontend Service Variables:

| Variable | Description | Example |
|----------|-------------|---------|
| `REACT_APP_API_URL` | Backend API URL | Auto-set from backend service |

## Troubleshooting

### Backend won't start
- Check logs in Render dashboard
- Verify MongoDB connection string is correct
- Ensure all environment variables are set

### CORS errors
- Verify `CLIENT_ORIGIN` matches your frontend URL exactly
- Check that credentials are included in API calls

### Email not working
- Verify Gmail App Password is set correctly
- Check that `EMAIL_USER` and `EMAIL_PASS` are correct
- Gmail requires App Passwords (not regular passwords)

### Frontend can't connect to backend
- Check `REACT_APP_API_URL` environment variable
- Verify backend is running and accessible
- Check browser console for errors

## Free Tier Limitations

- Services spin down after 15 minutes of inactivity
- First request after spin-down may take 30-60 seconds
- 750 hours/month free (enough for one service running 24/7)
- Consider upgrading for production use

## Upgrading to Paid Plan

For production use, consider:
- **Starter Plan ($7/month)**: Always-on services, custom domains
- **Professional Plan**: Better performance, more resources

## Custom Domain Setup

1. In Render dashboard, go to your service
2. Click "Settings" → "Custom Domains"
3. Add your domain
4. Update DNS records as instructed
5. Update `CLIENT_ORIGIN` in backend to match your custom domain

## Continuous Deployment

Render automatically deploys when you push to your main branch. To disable:
1. Go to service settings
2. Under "Auto-Deploy", select "No"

## Support

- Render Docs: [render.com/docs](https://render.com/docs)
- Render Community: [community.render.com](https://community.render.com)

---

**Need Help?** Check the Render logs in your dashboard for detailed error messages.
